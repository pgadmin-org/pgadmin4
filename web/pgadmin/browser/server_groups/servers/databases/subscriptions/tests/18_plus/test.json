{
  "scenarios": [
    {
      "type": "create",
      "name": "Create  Subscription",
      "endpoint": "NODE-subscription.obj",
      "sql_endpoint": "NODE-subscription.sql_id",
      "msql_endpoint": "NODE-subscription.msql",
      "precondition_sql": "SELECT 1 FROM pg_replication_slots WHERE slot_name = 'test_create_subscription' UNION ALL SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM pg_replication_slots WHERE slot_name = 'test_create_subscription') AND pg_create_logical_replication_slot('test_create_subscription', 'pgoutput', false) IS NOT NULL LIMIT 1;",
      "data": {
          "name": "test_create_subscription",
          "subowner": "postgres",
          "host": "localhost",
          "port": 5434,
          "db": "postgres",
          "username": "postgres",
          "password": "edb",
          "connect_timeout": 10,
          "pub": ["test_publication"],
          "sslmode": "prefer",
          "copy_data": false,
          "create_slot": false,
          "enabled": false,
          "connect": false,
          "slot_name": "test_create_subscription",
          "sync": "remote_apply",
          "streaming": true,
          "binary": true,
          "two_phase": false,
          "disable_on_error": true,
          "run_as_owner": true,
          "password_required": true,
          "origin": "any",
          "service": "",
          "failover": false
      },
      "expected_sql_file": "create_subscription.sql",
      "expected_msql_file": "create_subscription_msql.sql"
    },
    {
      "type": "alter",
      "name": "Alter two_phase parameter of subscription",
      "endpoint": "NODE-subscription.obj_id",
      "sql_endpoint": "NODE-subscription.sql_id",
      "msql_endpoint": "NODE-subscription.msql_id",
      "data": {
        "two_phase": true
      },
      "expected_sql_file": "alter_two_phase_parameter.sql",
      "expected_msql_file": "alter_two_phase_parameter_msql.sql"
    },
    {
      "type": "alter",
      "name": "Alter  slot_name parameter of subscription",
      "endpoint": "NODE-subscription.obj_id",
      "sql_endpoint": "NODE-subscription.sql_id",
      "msql_endpoint": "NODE-subscription.msql_id",
      "data": {
        "slot_name": "None"
      },
      "expected_sql_file": "alter_slot_name_parameter.sql",
      "expected_msql_file": "alter_slot_name_parameter_msql.sql"
    },
    {
      "type": "delete",
      "name": "Drop subscription",
      "endpoint": "NODE-subscription.delete_id",
      "data": {
        "name": "test_create_subscription"
      },
      "post_scenario_sql": "SELECT 1 WHERE EXISTS (SELECT 1 FROM pg_replication_slots WHERE slot_name = 'test_create_subscription') AND (SELECT pg_drop_replication_slot('test_create_subscription')) IS NOT NULL UNION ALL SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM pg_replication_slots WHERE slot_name = 'test_create_subscription') LIMIT 1;"
    }
  ]
}
